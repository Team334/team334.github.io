---
layout: default
---

<link rel="stylesheet" href="{{ site.url }}/assets/css/layout/liveblog.css">
<link rel="shortcut icon" type="image/png" href="{{ site.url }}/assets/img/favicon.png">
<div class="container">
    <div class="content">
        <h3>
            Event Information:
        </h3>
        <label>Background image: </label><input type="text"/><br>
        <label>Location: </label><input type="text"/><br>
        <label>Event Brief: </label><textarea></textarea><br>
        <label>Flagship element: </label><input type="text"/><br>
        <button style="height:auto; width: auto;">Update info</button>
        <br>
        <center><button id="live">LIVE</button></center>
        <h3>
            Event Feed:
        </h3>
        <div class="chatbox">
            <span>Posting as: </span><input type="text"/> <span class="event-title">Troy 2019</span>
            <div style="display:flexbox">
                <input type="text" class="newMessage">
                <button style="height:auto; width: auto; font-size: 1em;">Post</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/5.8.3/firebase.js"></script>
<script>
    // Initialize Firebase
  var config = {
    apiKey: "AIzaSyC_lgb2HCIRVHpfb5gO0SEyp7vcQ8aedm8",
    authDomain: "liveblog-90921.firebaseapp.com",
    databaseURL: "https://liveblog-90921.firebaseio.com",
    projectId: "liveblog-90921",
    storageBucket: "liveblog-90921.appspot.com",
    messagingSenderId: "586362346563"
  };
  firebase.initializeApp(config);

  window.params = function(){
    var params = {};
    var param_array = window.location.href.split('?')[1].split('&');
    for(var i in param_array){
        x = param_array[i].split('=');
        params[x[0]] = x[1];
    }
    return params;
}();
</script>
<script src="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.css" />
<script>
    firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
            console.log(user);
        } else {
            console.log("fuck we don't have user")
        }
    });

    EVENT_NAME = window.params.event

    //Event  specific
    var dataUpdate = firebase.database().ref(EVENT_NAME+'/Posts');
    dataUpdate.on('value', function (snapshot) {
        posts = snapshot.val();
        addPosts(posts);

        function addPosts(posts) {
            postList = Object.keys(posts);
            el = document.querySelector("#stream");
            el.innerHTML = "";
            for (post in postList) {
                p = posts[postList[post]];
                console.log(postList[post]);
                dte = new Date(parseInt(postList[post]))
                el.innerHTML +=
                    `
                    <div class="card">
                        <div class="overview">
                            <div class="post" id="` +
                    postList[post] +
                    `">
                                <span class="post-author">
                                    <span class="author">
                                        <span class="author-name">` +
                    p.Author +
                    `</span>
                                    </span>
                                    <span class="time">` +
                    ('0' + dte.getMonth()).slice(-2) + '/' + ('0' + dte.getDay()).slice(-2) + ' - ' + ('0' +
                        dte.getHours()).slice(-2) + ':' + ('0' + dte.getMinutes()).slice(-2) + ':' + ('0' + dte
                        .getSeconds()).slice(-2) + `</span>
                                    ` + ((p.Pinned) ?
                        '<a href="#highlights"><span class="tooltip"> <span class="tooltiptext"> Back to Highlights </span> <i class="fa fa-star"></i> </span></a>' :
                        "") +
                    `
                                </span><br>
                                <span class="post-content">
                                    This is a sample post, look how cool!
                                </span>
                            </div>
                        </div>
                    </div>
                    `;
            }
        }
    });


    var metaUpdate = firebase.database().ref(EVENT_NAME+'/Metadata');
    metaUpdate.on('value', function (snapshot) {
        meta = snapshot.val()
        console.log(meta);
        setStatus(meta.Live);
        setBackground(meta.Background);
        setLocation(meta.Location);
        setDescription(meta.Details);
        setFlagship(meta.Flagship);


        function setStatus(isLive) {
            el = document.querySelector(".live");
            if (isLive) {
                el.className += " active";
                el.innerHTML = "Live";
            } else {
                el.className = "live";
                el.innerHTML = "Offline";
            }
        }

        function setBackground(backgroundSrc) {
            el = document.querySelector(".background-img");
            el.src = backgroundSrc
        }

        function setLocation(location) {
            el = document.querySelector("#location");
            el.innerHTML = location;
        }

        function setDescription(description) {
            el = document.querySelector("#description");
            el.innerHTML += description;
        }
    });

    function setFlagship(flagship) {
        el = document.querySelector(".flagship");
        el.innerHTML = flagship;
    }

    var pinUpdate = firebase.database().ref(EVENT_NAME+'/Pinned');
    pinUpdate.on('value', function (snapshot) {
        pins = snapshot.val();
        putPins(pins);

        function putPins(pins) {
            el = document.querySelector("#pins");
            pinList = Object.keys(pins);
            el.innerHTML = "";
            for (pin in pinList) {
                el.innerHTML +=
                    `
                    <div class="pin">
                        <a href="#` + pinList[pin] +
                    `">
                            <p>` + pins[pinList[pin]] +
                    `</p>
                        </a>
                    </div>
                    `;
            }
        }
    });
</script>

<style>
    .chatbox {
        background-color: #EEEEEE;
        width: 100%;
        padding: 20px;
        border-radius: 20px;
    }
    .event-title{
        float: right;
    }
    #live{
        margin: 20px;
    }
    .newMessage{
        flex: 1;
    }
</style>