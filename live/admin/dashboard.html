---
layout: default
---

<link rel="stylesheet" href="{{ site.url }}/assets/css/layout/liveblog.css">
<link rel="shortcut icon" type="image/png" href="{{ site.url }}/assets/img/favicon.png">
<div class="container">
    <div class="content">
        <h3>Your UID is <span id="UID"></span></h3>
        <h3>
            Event Information:
        </h3>

        <label for="inp" class="inp">
            <input type="text" id="background-img" placeholder="&nbsp;">
            <span class="label">Background</span>
            <span class="border"></span>
        </label>
        <label for="inp" class="inp">
            <input type="text" id="location" placeholder="&nbsp;">
            <span class="label">Location</span>
            <span class="border"></span>
        </label>
        <label for="inp" class="inp">
            <input type="text" id="brief" placeholder="&nbsp;">
            <span class="label">Brief</span>
            <span class="border"></span>
        </label>
        <label for="inp" class="inp">
            <input type="text" id="flagship" placeholder="&nbsp;">
            <span class="label">Flagship</span>
            <span class="border"></span>
        </label>
        <br>
        <center><button id="live" onclick="toggleLiveStatus()">LIVE</button></center>
        <h3>
            Event Feed:
        </h3>
        <div class="chatbox">
            <span>Posting as: </span><input id="author" type="text" /> <span class="event-title">Troy 2019</span>
            <div class="posts">
                <div id="p1"></div>
            </div>
            <div>
                <input id="isPinned" type="checkbox" />
                <input type="text" id="pinnedMessage" />
            </div>
            <div style="display:flex">
                <input type="text" id="newMessage" />
                <button onclick="createNewPost()" style="height:auto; width: auto; font-size: 1em;">Post</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/5.8.3/firebase.js"></script>
<script>
    // Initialize Firebase
  var config = {
    apiKey: "AIzaSyC_lgb2HCIRVHpfb5gO0SEyp7vcQ8aedm8",
    authDomain: "liveblog-90921.firebaseapp.com",
    databaseURL: "https://liveblog-90921.firebaseio.com",
    projectId: "liveblog-90921",
    storageBucket: "liveblog-90921.appspot.com",
    messagingSenderId: "586362346563"
  };
  firebase.initializeApp(config);

  window.params = function(){
    var params = {};
    var param_array = window.location.href.split('?')[1].split('&');
    for(var i in param_array){
        x = param_array[i].split('=');
        params[x[0]] = x[1];
    }
    return params;
}();
</script>
<script src="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.js"></script>
<script async src="//www.instagram.com/embed.js"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.css" />
<script>
    firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
            document.getElementById('UID').innerHTML = user.uid
        } else {
            console.log("fuck we don't have user")
        }
    });

    EVENT_NAME = window.params.event
    document.querySelector('.event-title').innerHTML = EVENT_NAME;
    IS_LIVE = 0;
    var dataUpdate = firebase.database().ref(EVENT_NAME + '/Posts');
    var pinUpdate = firebase.database().ref(EVENT_NAME + '/Pinned');


    dataUpdate.on('child_added', function (childSnapshot, prevChildKey) {
        p = childSnapshot.val();
        el = document.createElement('div')
        el.className = "card post-card";
        el.id = p.ID;
        dte = new Date(parseInt(p.ID));
        el.innerHTML =
            `
                <div class="overview">
                    <div class="post">
                        <span class="post-author">
                            <span class="author-name">` +
            p.ID + " - " + p.Author + `</span>
                            <span class="time">` + ('0' + dte.getMonth())
            .slice(-2) + '.' + ('0' + dte.getDay()).slice(-2) + '.' + ('0' + dte.getYear()).slice(-2) + ' ' + (
                '0' + dte.getHours()).slice(-2) + ':' + ('0' + dte.getMinutes()).slice(-2) + ':' + ('0' + dte.getSeconds())
            .slice(-2) + `</span>
                            ` + ((p.Pinned) ?
                '<a title="Back to Highlights" href="#highlights"><i class="fa fa-thumb-tack"></i></span></a>' :
                "") +
            `
                        </span><button class="edit" onclick="ActivateEdit(this)" style="height:auto; width: auto; font-size: 1em;">Edit</button><br>
                        <span class="post-content">
                            ` +
            p.Post +
            `
                        </span>
                    </div>
                </div>
            `;
        el.appendAfter(document.querySelector('#p1'))
        window.instgrm.Embeds.process();
        twttr.widgets.load()
    });

    dataUpdate.on('child_changed', function (childSnapshot, prevChildKey) {
        p = childSnapshot.val();
        el = document.getElementById(p.ID);
        dte = new Date(parseInt(p.ID));
        el.innerHTML =
            `
            <div class="overview">
                <div class="post">
                    <span class="post-author">
                        <span class="author-name">` +
            p.ID + " - " + p.Author + `</span>
                        <span class="time">` + ('0' + dte.getMonth())
            .slice(-2) + '.' + ('0' + dte.getDay()).slice(-2) + '.' + ('0' + dte.getYear()).slice(-2) + ' ' + (
                '0' + dte.getHours()).slice(-2) + ':' + ('0' + dte.getMinutes()).slice(-2) + ':' + ('0' + dte.getSeconds())
            .slice(-2) + `</span>
                        ` + ((p.Pinned) ?
                '<a title="Back to Highlights" href="#highlights"><i class="fa fa-thumb-tack"></i></span></a>' :
                "") +
            `
                    </span><button class="edit" onclick="ActivateEdit(this)" style="height:auto; width: auto; font-size: 1em;">Edit</button><br>
                    <span class="post-content">
                        ` +
            p.Post + `
                    </span>
                </div>
            </div>
            `;
        window.instgrm.Embeds.process();
        twttr.widgets.load()
    });

    dataUpdate.on('child_removed', function (childSnapshot, prevChildKey) {
        p = childSnapshot.val();
        el = document.getElementById(p.ID);
        el.remove();
    });

    function ActivateEdit(el) {
        content = el.nextSibling.nextSibling.nextSibling.innerHTML;
        el.nextSibling.nextSibling.nextSibling.innerHTML = '<textarea>' + content +
            '</textarea><button class="edit" onclick="SubmitEdit(this)" style="height:auto; width: auto; font-size: 1em;">Edit</button><br><br><button class="edit" onclick="DeleteThis(this)" style="height:auto; width: auto; font-size: 1em;">Delete</button>';
    }

    function SubmitEdit(el) {
        content = el.previousSibling.value;
        pid = el.parentElement.parentElement.parentElement.parentElement.id;
        dataUpdate.child(pid).update({
            Post: content,
        })
    }

    function DeleteThis(el) {
        ref = el.parentElement.parentElement.parentElement.parentElement.id;
        dataUpdate.child(ref).remove();
        pinUpdate.child(ref).remove();

    }

    function createNewPost() {
        timenow = +new Date();
        dataUpdate.child(timenow).set({
            Author: document.getElementById("author").value,
            Pinned: document.getElementById("isPinned").value,
            ID: timenow,
            Post: document.getElementById("newMessage").value,
            type: "text"
        });
        if (document.getElementById("isPinned")) {
            pinUpdate.child(timenow).set(document.getElementById("pinnedMessage").value);
            document.getElementById('pinnedMessage').value = "";
            document.getElementById('isPinned').value = false
        }
        document.getElementById("newMessage").value = "";
    }

    var metaUpdate = firebase.database().ref(EVENT_NAME + '/Metadata');
    metaUpdate.on('value', function (snapshot) {
        meta = snapshot.val()
        // console.log(meta);
        setStatus(meta.Live);
        setBackground(meta.Background);
        setLocation(meta.Location);
        setDescription(meta.Details);
        setFlagship(meta.Flagship);


        function setStatus(isLive) {
            el = document.getElementById("live");
            if (isLive) {
                el.className = "active";
                el.innerHTML = "Live";
                IS_LIVE = 1
            } else {
                el.className = "";
                el.innerHTML = "Offline";
                IS_LIVE = 0;
            }
        }

        function setBackground(backgroundSrc) {
            el = document.getElementById("background-img");
            el.value = backgroundSrc
        }

        function setLocation(location) {
            el = document.getElementById("location");
            el.value = location;
        }

        function setDescription(description) {
            el = document.getElementById("brief");
            el.value = description;
        }
    });

    function setFlagship(flagship) {
        el = document.getElementById("flagship");
        el.value = flagship;
    }

    function updateMeta() {
        metaUpdate.update({
            Background: document.getElementById("background-img").value,
            Details: document.getElementById('brief').value,
            Flagship: document.getElementById("flagship").value,
            Location: document.getElementById('location').value,
        })
    }

    function toggleLiveStatus() {
        metaUpdate.update({
            Live: ((IS_LIVE) ? 0 : 1)
        })
    }

    Element.prototype.appendAfter = function (element) {
        element.parentNode.insertBefore(this, element.nextSibling);
    }, false;
</script>

<style>
    .chatbox {
        background-color: #EEEEEE;
        width: 100%;
        padding: 20px;
        border-radius: 20px;
    }

    .posts {
        height: 90%;
        overflow: scroll;
    }

    .event-title {
        float: right;
    }

    #live {
        margin: 20px;
    }

    .newMessage {
        flex: 1;
    }

    .active {
        animation-name: live;
        animation-duration: 2s;
        animation-iteration-count: infinite;
        color: white;
    }

    @keyframes live {
        0% {
            background-color: rgba(200, 0, 0, 0.8)
        }

        50% {
            background-color: rgba(255, 0, 0, 0.8)
        }

        100% {
            background-color: rgba(200, 0, 0, 0.8)
        }
    }

    .inp {
        position: relative;
        margin: auto;
        width: 100%;
        max-width: 280px;
    }

    .inp .label {
        position: absolute;
        top: 16px;
        left: 0;
        font-size: 16px;
        color: #9098a9;
        font-weight: 500;
        transform-origin: 0 0;
        transition: all 0.2s ease;
    }

    .inp .border {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 2px;
        width: 100%;
        background: #07f;
        transform: scaleX(0);
        transform-origin: 0 0;
        transition: all 0.15s ease;
    }

    .inp input {
        -webkit-appearance: none;
        width: 100%;
        border: 0;
        font-family: inherit;
        padding: 12px 0;
        height: 48px;
        font-size: 16px;
        font-weight: 500;
        border-bottom: 2px solid #c8ccd4;
        background: none;
        border-radius: 0;
        color: #223254;
        transition: all 0.15s ease;
    }

    .inp input:hover {
        background: rgba(34, 50, 84, 0.03);
    }

    .inp input:not(:placeholder-shown)+span {
        color: #5a667f;
        transform: translateY(-26px) scale(0.75);
    }

    .inp input:focus {
        background: none;
        outline: none;
    }

    .inp input:focus+span {
        color: #07f;
        transform: translateY(-26px) scale(0.75);
    }

    .inp input:focus+span+.border {
        transform: scaleX(1);
    }
</style>